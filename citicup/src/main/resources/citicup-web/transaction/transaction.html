<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Transaction</title>
    <link href="../lib/bootstrap-4.0.0-dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="../components/top-nav.css" rel="stylesheet"/>
    <link href="transaction.css" rel="stylesheet"/>
    <link rel="stylesheet" href="../lib/layui/css/layui.css" media="all">
    <script src="../lib/jquery-3.3.1.js"></script>
    <script src="../lib/bootstrap-4.0.0-dist/js/bootstrap.min.js"></script>
    <script src="../lib/echarts.min.js"></script>
    <script src="../lib/layui/layui.js"></script>
</head>
<body>
<div class="top-nav"></div>
<div class="content-wrapper">
    <div class="content">

        <!-- transaction板块 -->
        <div class="transactionboard">
            <div class="topinfo">
                <div class="futurename" id="futurename0"></div>
                <button class="redeembutton">赎回</button>
            </div>

            <!-- gross & funds boards & history-->
            <div class="grossfundschoose">
                <button class="gross" onclick="grossclick(0)">收益</button>
                <button class="funds" onclick="fundsclick(0)">资金占用</button>
                <button class="history" onclick="historyclick(0)">历史调仓</button>
                <div class="choose_bottom"></div>

                <div class="gross_bottom" id="gross_bottom0"></div>
                <div class="funds_bottom" id="funds_bottom0"></div>
                <div class="history_bottom" id="history_bottom0"></div>
            </div>

            <div class="gorssboard" id="grossboard0">
                <div class="grossinfo">
                    <div class="zoom">缩放：</div>

                    <button class="zoombutton">1星期</button>
                    <button class="zoombutton">1个月</button>
                    <button class="zoombutton">6个月</button>
                    <button class="zoombutton">半年</button>
                    <button class="zoombutton">全部</button>

                    <!-- lengend -->
                    <div class="lg">
                        <div class="lg_red" id="redBottom0"></div>
                        <div class="lg_red_text" id="redText0">收益</div>
                        <div class="lg_blue" id="blueBottom0"></div>
                        <div class="lg_blue_text" id="blueText0">收益</div>
                    </div>

                </div>
                <div class="graphdiv" id="graphdiv0"></div>
            </div>

            <!-- 当前持仓 -->
            <!-- current-->
            <div class="currentnewestchoose">
                <button class="current" onclick="currentclick()">当前持仓</button>
                <div class="choose_bottom2"></div>

                <div class="current_bottom" id="current_bottom0"></div>
            </div>


            <div class="currentboard" id="currentboard0">

                <table class="layui-table" >
                    <colgroup >
                        <col width="50">
                        <col width="50">
                        <col width="50">
                    </colgroup>

                    <tbody>
                    <tr>
                        <td>合约标的</td>
                        <td id="nearName0"></td>
                        <td id="backName0"></td>
                    </tr>
                    <tr>
                        <td>数量</td>
                        <td id="nearPosition0"></td>
                        <td id="backPosition0"></td>
                    </tr>
                    <tr>
                        <td>市值</td>
                        <td class="marketvalue1" id="nearPrice0"></td>
                        <td class="marketvalue2" id="backPrice0"></td>
                    </tr>
                    <tr>
                        <td>仓位</td>
                        <td colspan="2" id="position0"></td>
                    </tr>
                    <tr>
                        <td>当日赢亏</td>
                        <td colspan="2" id="today0"></td>
                    </tr>
                    <tr>
                        <td>盈亏比</td>
                        <td colspan="2" id="todayrate0"></td>
                    </tr>
                    </tbody>
                </table>
            </div>

        </div>


        <div class="transactionboard">
            <div class="topinfo">
                <div class="futurename" id="futurename1"></div>
                <button class="redeembutton">赎回</button>
            </div>

            <!-- gross & funds boards & history-->
            <div class="grossfundschoose">
                <button class="gross" onclick="grossclick(1)">收益</button>
                <button class="funds" onclick="fundsclick(1)">资金占用</button>
                <button class="history" onclick="historyclick(1)">历史调仓</button>
                <div class="choose_bottom"></div>

                <div class="gross_bottom" id="gross_bottom1"></div>
                <div class="funds_bottom" id="funds_bottom1"></div>
                <div class="history_bottom" id="history_bottom1"></div>
            </div>

            <div class="gorssboard" id="grossboard1">
                <div class="grossinfo">
                    <div class="zoom">缩放：</div>

                    <button class="zoombutton">1星期</button>
                    <button class="zoombutton">1个月</button>
                    <button class="zoombutton">6个月</button>
                    <button class="zoombutton">半年</button>
                    <button class="zoombutton">全部</button>

                    <!-- lengend -->
                    <div class="lg">
                        <div class="lg_red" id="redBottom1"></div>
                        <div class="lg_red_text" id="redText1">收益</div>
                        <div class="lg_blue" id="blueBottom1"></div>
                        <div class="lg_blue_text" id="blueText1">收益</div>
                    </div>

                </div>
                <div class="graphdiv" id="graphdiv1"></div>
            </div>

            <!-- 当前持仓 -->
            <!-- current-->
            <div class="currentnewestchoose">
                <button class="current" onclick="currentclick()">当前持仓</button>
                <div class="choose_bottom2"></div>

                <div class="current_bottom" id="current_bottom1"></div>
            </div>


            <div class="currentboard" id="currentboard1">

                <table class="layui-table" >
                    <colgroup >
                        <col width="50">
                        <col width="50">
                        <col width="50">
                    </colgroup>

                    <tbody>
                    <tr>
                        <td>合约标的</td>
                        <td id="nearName1"></td>
                        <td id="backName1"></td>
                    </tr>
                    <tr>
                        <td>数量</td>
                        <td id="nearPosition1"></td>
                        <td id="backPosition1"></td>
                    </tr>
                    <tr>
                        <td>市值</td>
                        <td class="marketvalue1" id="nearPrice1"></td>
                        <td class="marketvalue2" id="backPrice1"></td>
                    </tr>
                    <tr>
                        <td>仓位</td>
                        <td colspan="2" id="position1"></td>
                    </tr>
                    <tr>
                        <td>当日赢亏</td>
                        <td colspan="2" id="today1"></td>
                    </tr>
                    <tr>
                        <td>盈亏比</td>
                        <td colspan="2" id="todayrate1"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="transactionboard">
            <div class="topinfo">
                <div class="futurename" id="futurename2"></div>
                <button class="redeembutton">赎回</button>
            </div>

            <!-- gross & funds boards & history-->
            <div class="grossfundschoose">
                <button class="gross" onclick="grossclick(2)">收益</button>
                <button class="funds" onclick="fundsclick(2)">资金占用</button>
                <button class="history" onclick="historyclick(2)">历史调仓</button>
                <div class="choose_bottom"></div>

                <div class="gross_bottom" id="gross_bottom2"></div>
                <div class="funds_bottom" id="funds_bottom2"></div>
                <div class="history_bottom" id="history_bottom2"></div>
            </div>

            <div class="gorssboard" id="grossboard2">
                <div class="grossinfo">
                    <div class="zoom">缩放：</div>

                    <button class="zoombutton">1星期</button>
                    <button class="zoombutton">1个月</button>
                    <button class="zoombutton">6个月</button>
                    <button class="zoombutton">半年</button>
                    <button class="zoombutton">全部</button>

                    <!-- lengend -->
                    <div class="lg">
                        <div class="lg_red" id="redBottom2"></div>
                        <div class="lg_red_text" id="redText2">收益</div>
                        <div class="lg_blue" id="blueBottom2"></div>
                        <div class="lg_blue_text" id="blueText2">收益</div>
                    </div>

                </div>
                <div class="graphdiv" id="graphdiv2"></div>
            </div>

            <!-- 当前持仓 -->
            <!-- current-->
            <div class="currentnewestchoose">
                <button class="current" onclick="currentclick()">当前持仓</button>
                <div class="choose_bottom2"></div>

                <div class="current_bottom" id="current_bottom2"></div>
            </div>


            <div class="currentboard" id="currentboard2">

                <table class="layui-table" >
                    <colgroup >
                        <col width="50">
                        <col width="50">
                        <col width="50">
                    </colgroup>

                    <tbody>
                    <tr>
                        <td>合约标的</td>
                        <td id="nearName2"></td>
                        <td id="backName2"></td>
                    </tr>
                    <tr>
                        <td>数量</td>
                        <td id="nearPosition2"></td>
                        <td id="backPosition2"></td>
                    </tr>
                    <tr>
                        <td>市值</td>
                        <td class="marketvalue1" id="nearPrice2"></td>
                        <td class="marketvalue2" id="backPrice2"></td>
                    </tr>
                    <tr>
                        <td>仓位</td>
                        <td colspan="2" id="position2"></td>
                    </tr>
                    <tr>
                        <td>当日赢亏</td>
                        <td colspan="2" id="today2"></td>
                    </tr>
                    <tr>
                        <td>盈亏比</td>
                        <td colspan="2" id="todayrate2"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>
<div class="footer"></div>
</body>

<script>

    $("button").css("outline","none");
    $("td").css("font-size","18px");
    $("td").css("padding","0px");
    $("td").css("text-align","center");

    $("tr").css("height","50px");

    function grossclick(id){
        $("#funds_bottom"+id).css("visibility","hidden");
        $("#gross_bottom"+id).css("visibility","visible");
        $("#history_bottom"+id).css("visibility","hidden");
        insertGross(id);
    }

    function fundsclick(id){
        $("#funds_bottom"+id).css("visibility","visible");
        $("#gross_bottom"+id).css("visibility","hidden");
        $("#history_bottom"+id).css("visibility","hidden");

        insertFunds(id);
    }

    function historyclick(id){
        $("#funds_bottom"+id).css("visibility","hidden");
        $("#gross_bottom"+id).css("visibility","hidden");
        $("#history_bottom"+id).css("visibility","visible");
        insertHistory(id);
    }



    var PAGENUM = 3;
    var tradeFilterInfo = {
        "userId":1,
        "page":0,
        "pageNum":PAGENUM
    };

    var tradeList;

    function getTradeList(){
        $.ajax({
            url:"http://localhost:8080/api/contract/getMyTradeList",
            async:false,
            type:"POST",
            data:tradeFilterInfo,
            dataType: "JSON",
            success: function (data){
                tradeList = data;
            },
            error: function (data){
                alert("Please try again latar,");
            }
        });

        initTables();
    }

    function sign(num){
        if(num>0){
            return "+"+num;
        }else if(num<0){
            return "-"+num;
        }else{
            return num;
        }
    }



    function initTables(){
        for(var i=0;i<tradeList.length;i++){
            var trade = tradeList[i];

            $("#futurename"+i).html(sign(trade.contractName));
            $("#nearName"+i).html(sign(trade.nearbyFuturesName));
            $("#backName"+i).html(sign(trade.backFuturesName));
            $("#nearPosition"+i).html(trade.nearbyFuturesPosition);
            $("#backPosition"+i).html(trade.backFuturesPosition);
            $("#nearPrice"+i).html(trade.nearbyFuturesPrice);
            $("#backPrice"+i).html(trade.backFuturesPrice);
            $("#position"+i).html(parseFloat((trade.position*100).toFixed(2))+"%");
            $("#today"+i).html(trade.todayProfitLoss);
            $("#todayrate"+i).html(parseFloat((trade.profitLossRatio*100).toFixed(2))+"%");
        }
    }

    $(document).ready(function(){
        getTradeList();
        insertGross();
    });



    function format(list){
        var res = [];
        for(var i=0;i<list.length;i++){
            res.push(list[i].substring(0,19));
        }
        return res;
    }

    function insertGross(id){
        $("#redText"+id).css("visibility","hidden");
        $("#redBottom"+id).css("visibility","hidden");
        $("#blueText"+id).html("收益");

        var myChart = echarts.init(document.getElementById('graphdiv'+id));
        option = {
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                top: '4%',
                containLabel: true
            },
            dataZoom: [
                {
                    show: true,
                    realtime: true,
                    start: 0,
                    end: 100,
                    height: 30,
                },
                {
                    type: 'inside',
                    realtime: true,
                    start: 0,
                    end: 100

                }
            ],
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: format(tradeList[i].updateTimes)
            },
            yAxis: {
                position: 'right',
                type: 'value'
            },
            series: [
                {
                    name: "收益",
                    data: tradeList[i].yields,
                    type: 'line',
                    sampling: 'average',
                    areaStyle: {
                        normal: {
                            color: "#DAE4F4"
                        }
                    },
                    lineStyle: {
                        normal: {
                            width: 3,
                            color: '#4577C8'
                        }
                    },
                }
            ]
        };
        myChart.setOption(option,true);
    }



    function insertFunds(id){
        $("#redText"+id).css("visibility","hidden");
        $("#redBottom"+id).css("visibility","hidden");
        $("#blueText"+id).html("资金占用");

        var myChart = echarts.init(document.getElementById('graphdiv'+id));
        option = {
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                top: '4%',
                containLabel: true
            },
            dataZoom: [
                {
                    show: true,
                    realtime: true,
                    start: 0,
                    end: 100,
                    height: 30,
                },
                {
                    type: 'inside',
                    realtime: true,
                    start: 0,
                    end: 100

                }
            ],
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: format(tradeList[i].updateTimes)
            },
            yAxis: {
                position: 'right',
                type: 'value'
            },
            series: [
                {
                    name: "占用资金",
                    data: tradeList[i].positions,
                    type: 'line',
                    sampling: 'average',
                    areaStyle: {
                        normal: {
                            color: "#DAE4F4"
                        }
                    },
                    lineStyle: {
                        normal: {
                            width: 3,
                            color: '#4577C8'
                        }
                    },
                }
            ]
        };
        myChart.setOption(option,true);
    }



    function insertHistory(id){
        $("#redText"+id).css("visibility","visible");
        $("#redBottom"+id).css("visibility","visible");
        $("#redText"+id).html("近月期货");
        $("#blueText"+id).html("远月期货");

        var myChart = echarts.init(document.getElementById('graphdiv'+id));
        option = {
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                top: '4%',
                containLabel: true
            },
            dataZoom: [
                {
                    show: true,
                    realtime: true,
                    start: 0,
                    end: 100,
                    height: 30,
                },
                {
                    type: 'inside',
                    realtime: true,
                    start: 0,
                    end: 100

                }
            ],
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: format(tradeList[i].updateTimes)
            },
            yAxis: {
                position: 'right',
                type: 'value'
            },
            series: [
                {
                    name: "近月期货",
                    data: tradeList[i].nearbyFuturesPositionOperations,
                    type: 'line',
                    lineStyle: {
                        normal: {
                            width: 3,
                            color: "#A34240"
                        }
                    },

                },
                {
                    name: "远月期货",
                    data: tradeList[i].backFuturesPositionOperations,
                    type: 'line',
                    lineStyle: {
                        normal: {
                            width: 3,
                            color: "#4577C8"
                        }
                    },
                }
            ]
        };
        myChart.setOption(option,true);
    }





    function insertGross(){
        for(var i=0;i<tradeList.length;i++){

            $("#redText"+i).css("visibility","hidden");
            $("#redBottom"+i).css("visibility","hidden");
            $("#blueText"+i).html("收益");

            var trade = tradeList[i];

            var myChart = echarts.init(document.getElementById('graphdiv'+i));
            option = {
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: '4%',
                    containLabel: true
                },
                dataZoom: [
                    {
                        show: true,
                        realtime: true,
                        start: 0,
                        end: 100,
                        height: 30,
                    },
                    {
                        type: 'inside',
                        realtime: true,
                        start: 0,
                        end: 100

                    }
                ],
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: format(trade.updateTimes)
                },
                yAxis: {
                    position: 'right',
                    type: 'value'
                },
                series: [
                    {
                        name: "收益",
                        data: trade.yields,
                        type: 'line',
                        sampling: 'average',
                        areaStyle: {
                            normal: {
                                color: "#DAE4F4"
                            }
                        },
                        lineStyle: {
                            normal: {
                                width: 3,
                                color: '#4577C8'
                            }
                        },
                    }
                ]
            };
            myChart.setOption(option,true);
        }

    }



    var myChart = echarts.init(document.getElementById('graphdiv'));
  //  var myChart1 = echarts.init(document.getElementById('grossdiv1'));


    option = {
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            top: '4%',
            containLabel: true
        },


        dataZoom: [

            {
                show: true,
                realtime: true,
                start: 0,
                end: 100,
                height: 30,
            },
            {
                type: 'inside',
                realtime: true,
                start: 0,
                end: 100

            }



        ],



        xAxis: {
            type: 'category',
            boundaryGap: false,
            data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
        },
        yAxis: {
            position: 'right',
            type: 'value'
        },
        series: [
            {
                name: "回测利率",
                data: [820, -932, 901, 934, 1290, 1330, 1320],
                type: 'line',
                sampling: 'average',
                areaStyle: {
                    normal: {
                        color: "#DAE4F4"
                    }
                },
                lineStyle: {
                    normal: {
                        width: 3,
                        color: '#4577C8'
                    }
                },
            },
            {
                name: "基准利率",
                data: [80, 1922, 901, 934, 1290, 1330, 1320],
                type: 'line',
                lineStyle: {
                    normal: {
                        width: 3,
                        color: "#A34240"
                    }
                },

            }
        ]
    };


    myChart.setOption(option,true);
   // myChart1.setOption(option);

</script>

<script src="../util/href-helper.js"></script>
<script src="../components/top-nav.js"></script>
</html>





































